{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\n// protected routes that require authentication\nconst PROTECTED_ROUTES = [\n  '/pets',\n  '/profile',\n  '/vets',\n];\n\n// public routes (allowed without auth)\nconst PUBLIC_ROUTES = [\n  '/',\n  '/login',\n  '/signup',\n  '/forgot-password',\n  '/reset-password',\n  '/verify-email',\n];\n\n/**\n * Check if a path matches any of the protected routes\n */\nfunction isProtectedRoute(pathname: string): boolean {\n  return PROTECTED_ROUTES.some(route => pathname.startsWith(route));\n}\n\n/**\n * Check if a path is explicitly public\n */\nfunction isPublicRoute(pathname: string): boolean {\n  return PUBLIC_ROUTES.some(route => pathname === route || pathname.startsWith(route));\n}\n\n/**\n * Middleware to protect routes requiring authentication\n * Runs on the server before the page loads\n */\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Skip middleware for Next.js internals and static files\n  if (\n    pathname.startsWith('/_next') ||\n    pathname.startsWith('/api') ||\n    pathname.includes('.') // static files (images, fonts, etc.)\n  ) {\n    return NextResponse.next();\n  }\n\n  // Check if route needs protection\n  const needsAuth = isProtectedRoute(pathname);\n  \n  if (!needsAuth) {\n    return NextResponse.next();\n  }\n\n  // Check for session better-auth in cookies\n  // Check name in console, common 'better-auth.session_token'\n  // Name set to: pettr-auth.session_token\n  const sessionToken = request.cookies.get('pettr-auth.session_token');\n  \n  // If no session token, redirect to login\n  if (!sessionToken) {\n    console.log(`ðŸ”’ Middleware: Blocking access to ${pathname} - No session`);\n    const loginUrl = new URL('/login', request.url);\n    // Add redirect parameter to return user after login\n    loginUrl.searchParams.set('redirect', pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  // Session exists, allow access\n  console.log(`âœ… Middleware: Allowing access to ${pathname}`);\n  return NextResponse.next();\n}\n\n/**\n * Configure which routes this middleware runs on\n */\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files (public folder)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGA,+CAA+C;AAC/C,MAAM,mBAAmB;IACvB;IACA;IACA;CACD;AAED,uCAAuC;AACvC,MAAM,gBAAgB;IACpB;IACA;IACA;IACA;IACA;IACA;CACD;AAED;;CAEC,GACD,SAAS,iBAAiB,QAAgB;IACxC,OAAO,iBAAiB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;AAC5D;AAEA;;CAEC,GACD,SAAS,cAAc,QAAgB;IACrC,OAAO,cAAc,IAAI,CAAC,CAAA,QAAS,aAAa,SAAS,SAAS,UAAU,CAAC;AAC/E;AAMO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,yDAAyD;IACzD,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,WACpB,SAAS,QAAQ,CAAC,KAAK,qCAAqC;MAC5D;QACA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,kCAAkC;IAClC,MAAM,YAAY,iBAAiB;IAEnC,IAAI,CAAC,WAAW;QACd,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,2CAA2C;IAC3C,4DAA4D;IAC5D,wCAAwC;IACxC,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEzC,yCAAyC;IACzC,IAAI,CAAC,cAAc;QACjB,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,SAAS,aAAa,CAAC;QACxE,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,oDAAoD;QACpD,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;QACtC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,+BAA+B;IAC/B,QAAQ,GAAG,CAAC,CAAC,iCAAiC,EAAE,UAAU;IAC1D,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAKO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}